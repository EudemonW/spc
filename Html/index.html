<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">
    <link rel="icon" href="./asserts/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="/asserts/jquery.min.js"></script>
    <script src="/asserts/code/highcharts.js"></script>
    <script src="/asserts/code/modules/exporting.js"></script>
    <script src="/asserts/code/modules/data.js"></script>
    <script src="/asserts/code/modules/series-label.js"></script>
    <script src="/asserts/code/modules/oldie.js"></script>
</head>

<body>
<div>

    设备编号：<input placeholder="请输入设备编号" id="a" type="text">
    <input type="button" value="查询" onclick="huoqu()"/>

</div>
<div id="container">

</div>

<script>

    function huoqu() {
        var no = document.getElementById('a').value;
        // alert(no)
        if (no == '') {
            alert("请重新输入设备编号");
        } else {
            $.get('spc/getDevice?no=' + no, function (data) {
                var json = eval(data);
                console.log(json[0].length);
                Highcharts.setOptions({
                    // 所有语言文字相关配置都设置在 lang 里
                    lang: {
                        resetZoom: '恢复缩放',
                        resetZoomTitle: '重置缩放比例',
                        downloadPNG: '下载PNG文件',
                        downloadJPEG: '下载JPE图片',
                        downloadPDF: '下载PDF文件',
                        downloadSVG: '下载SVG文件',
                        loading: "加载中",
                    }
                });
                let html = "";
                for (var i = 1; i <= json[0].length; i++) {
                    var str = "container";
                    tem = str + i;
                    temp = tem + "x";
                    html += "<div id=" + tem + " style=\"min-width:400px;height:500px\"></div><br><br>";
                    html += "<div id=" + temp + " style=\"min-width:400px;height:500px\"></div><br><br>";
                }
                $("#container").html(html);
                for (var i = 1; i <= json[0].length; i++) {
                    var str = "container";
                    tem = str + i;
                    temp = tem + "x";
                    console.log(tem);
                    var j = i - 1;
                    var sigma_r = (json[0][j].UCL - json[0][j].center) / 3;
                    var sigma_x = (json[1][j].UCL - json[1][j].LCL) / 6;
                    Highcharts.chart(tem, {
                        chart: {
                            type: 'line',
                            zoomType: 'x',
                            selectionMarkerFill: 'rgba(0,0,0, 0.2)',
                            panning: true,
                            panKey: 'ctrl',
                            resetZoomButton: {
                                // 按钮定位
                                position: {
                                    align: 'right', // by default
                                    verticalAlign: 'top', // by default
                                    x: 0,
                                    y: -30
                                },
                                // 按钮样式
                                theme: {
                                    fill: 'white',
                                    stroke: 'silver',
                                    r: 0,
                                    states: {
                                        hover: {
                                            fill: '#41739D',
                                            style: {
                                                color: 'white'
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        title: {
                            text: '<b>设备编号：' + no + '   尺寸类型：' + json[0][j].size + '  移动极差</b>'
                        },
                        subtitle: {
                            text: null
                        },
                        xAxis: {
                            //categories:
                            categories: json[0][j].x,
                            labels: {
                                step: 10 //10就是x轴显示的间隔
                            }
                        },
                        yAxis: {
                            plotLines: [{
                                color: 'red', //线的颜色，定义为红色
                                dashStyle: 'solid', //默认值，这里定义为实线
                                value: json[0][j].UCL, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                width: 1, //标示线的宽度，2px
                                label: {
                                    text: 'UCL',     //标签的内容
                                    align: 'left',                //标签的水平位置，水平居左,默认是水平居中center
                                    x: 0                         //标签相对于被定位的位置水平偏移的像素，重新定位，水平居左10px
                                }
                            }, {
                                color: 'red', //线的颜色，定义为红色
                                dashStyle: 'solid', //默认值，这里定义为实线
                                value: json[0][j].LCL, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                width: 1, //标示线的宽度，2px
                                label: {
                                    text: 'LCL',     //标签的内容
                                    align: 'left',                //标签的水平位置，水平居左,默认是水平居中center
                                    x: 0                         //标签相对于被定位的位置水平偏移的像素，重新定位，水平居左10px
                                }
                            }, {
                                color: 'blue', //线的颜色，定义为红色
                                dashStyle: 'solid', //默认值，这里定义为实线
                                value: json[0][j].center, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                width: 1, //标示线的宽度，2px
                                label: {
                                    text: '中心线',     //标签的内容
                                    align: 'left',                //标签的水平位置，水平居左,默认是水平居中center
                                    x: 0                         //标签相对于被定位的位置水平偏移的像素，重新定位，水平居左10px
                                }
                            },
                                {
                                    color: '#b3b15b', //线的颜色，定义为红色
                                    dashStyle: 'Dash', //默认值，这里定义为实线
                                    value: json[0][j].UCL - sigma_r * 1, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                    width: 1, //标示线的宽度，2px
                                },
                                {
                                    color: '#b3b15b', //线的颜色，定义为红色
                                    dashStyle: 'Dash', //默认值，这里定义为实线
                                    value: json[0][j].UCL - sigma_r * 2, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                    width: 1, //标示线的宽度，2px
                                },
                                {
                                    color: '#b3b15b', //线的颜色，定义为红色
                                    dashStyle: 'Dash', //默认值，这里定义为实线
                                    value: json[0][j].UCL - sigma_r * 4, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                    width: 1, //标示线的宽度，2px
                                }],
                        },
                        tooltip: {
                            formatter: function () {
                                //console.log(this)
                                if (this.point.name == '') {
                                    this.point.name = ''
                                }
                                if (this.point.method == '') {
                                    this.point.method = ''
                                }
                                return '时间: ' + '<b>' + this.x + '</b>' + '<br/>' +
                                    this.series.name + ': ' + '<b>' + this.y + '</b>' + '<br/>' +
                                    '处理人: ' + '<b>' + this.point.name + '</b>' + '<br/>' +
                                    '处理措施: ' + '<b>' + this.point.method + '</b>';
                            }
                        },
                        plotOptions: {
                            line: {
                                dataLabels: {
                                    // 开启数据标签
                                    enabled: true,
                                    useHTML: true,
                                    formatter: function () {
                                        return this.point.img
                                    }
                                },
                                // 关闭鼠标跟踪，对应的提示框、点击事件会失效
                                enableMouseTracking: true
                            },
                            spline: {
                                marker: {
                                    radius: 4,
                                    lineColor: '#191970',
                                    lineWidth: 10
                                }
                            },
                        },
                        series: [{
                            name: '移动极差',
                            data: json[0][j].y
                        }],
                        credits: {
                            enabled: false // 禁用版权显示信息
                        }
                    });
                    Highcharts.chart(temp, {
                        chart: {
                            type: 'line',
                            zoomType: 'x',
                            selectionMarkerFill: 'rgba(0,0,0, 0.2)',
                            panning: true,
                            panKey: 'ctrl',
                            resetZoomButton: {
                                // 按钮定位
                                position: {
                                    align: 'right', // by default
                                    verticalAlign: 'top', // by default
                                    x: 0,
                                    y: -30
                                },
                                // 按钮样式
                                theme: {
                                    fill: 'white',
                                    stroke: 'silver',
                                    r: 0,
                                    states: {
                                        hover: {
                                            fill: '#41739D',
                                            style: {
                                                color: 'white'
                                            }
                                        }
                                    }
                                }
                            }
                        },
                        title: {
                            text: '<b>设备编号：' + no + '  尺寸类型：' + json[1][j].size + '  单独值</b>'
                        },
                        subtitle: {
                            text: null
                        },
                        xAxis: {
                            //categories:
                            categories: json[1][j].x,
                            labels: {
                                step: 10 //10就是x轴显示的间隔
                            }
                        },
                        yAxis: {
                            title: {
                                text: "单独值"
                            },
                            plotLines: [{
                                color: 'red', //线的颜色，定义为红色
                                dashStyle: 'solid', //默认值，这里定义为实线
                                value: json[1][j].UCL, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                width: 1, //标示线的宽度，2px
                                label: {
                                    text: 'UCL',     //标签的内容
                                    align: 'left',                //标签的水平位置，水平居左,默认是水平居中center
                                    x: 0                         //标签相对于被定位的位置水平偏移的像素，重新定位，水平居左10px
                                }
                            }, {
                                color: 'red', //线的颜色，定义为红色
                                dashStyle: 'solid', //默认值，这里定义为实线
                                value: json[1][j].LCL, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                width: 1, //标示线的宽度，2px
                                label: {
                                    text: 'LCL',     //标签的内容
                                    align: 'left',                //标签的水平位置，水平居左,默认是水平居中center
                                    x: 0                         //标签相对于被定位的位置水平偏移的像素，重新定位，水平居左10px
                                }
                            }, {
                                color: 'blue', //线的颜色，定义为红色
                                dashStyle: 'solid', //默认值，这里定义为实线
                                value: json[1][j].center, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                width: 1, //标示线的宽度，2px
                                label: {
                                    text: '中心线',     //标签的内容
                                    align: 'left',                //标签的水平位置，水平居左,默认是水平居中center
                                    x: 0                         //标签相对于被定位的位置水平偏移的像素，重新定位，水平居左10px
                                }
                            },
                                {
                                    color: '#b3b15b', //线的颜色，定义为红色
                                    dashStyle: 'Dash', //默认值，这里定义为实线
                                    value: json[1][j].UCL - sigma_x * 1, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                    width: 1, //标示线的宽度，2px
                                }
                                ,
                                {
                                    color: '#b3b15b', //线的颜色，定义为红色
                                    dashStyle: 'Dash', //默认值，这里定义为实线
                                    value: json[1][j].UCL - sigma_x * 2, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                    width: 1, //标示线的宽度，2px
                                }, {
                                    color: '#b3b15b', //线的颜色，定义为红色
                                    dashStyle: 'Dash', //默认值，这里定义为实线
                                    value: json[1][j].UCL - sigma_x * 4, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                    width: 1, //标示线的宽度，2px
                                }, {
                                    color: '#b3b15b', //线的颜色，定义为红色
                                    dashStyle: 'Dash', //默认值，这里定义为实线
                                    value: json[1][j].UCL - sigma_x * 5, //定义在那个值上显示标示线，这里是在x轴上刻度为3的值处垂直化一条线
                                    width: 1, //标示线的宽度，2px
                                }

                            ],
                        },
                        tooltip: {
                            formatter: function () {
                                //console.log(this)
                                if (this.point.name == '') {
                                    this.point.name = '无'
                                }
                                if (this.point.method == '') {
                                    this.point.method = '无'
                                }
                                return '时间: ' + '<b>' + this.x + '</b>' + '<br/>' +
                                    this.series.name + ': ' + '<b>' + this.y + '</b>' + '<br/>' +
                                    '处理人: ' + '<b>' + this.point.name + '</b>' + '<br/>' +
                                    '处理措施: ' + '<b>' + this.point.method + '</b>';
                            }
                        }
                        ,
                        plotOptions: {
                            line: {
                                dataLabels: {
                                    // 开启数据标签
                                    enabled: true,
                                    useHTML: true,
                                    formatter: function () {
                                        return this.point.img
                                    }
                                }
                                ,
                                // 关闭鼠标跟踪，对应的提示框、点击事件会失效
                                enableMouseTracking: true
                            }
                            ,
                            spline: {
                                marker: {
                                    radius: 4,
                                    lineColor: '#191970',
                                    lineWidth: 10
                                }
                            }
                            ,
                        }
                        ,
                        series: [{
                            name: '单独值',
                            data: json[1][j].y,
                            marker: {
                                symbol: 'circle'
                            }
                        }],
                        credits: {
                            enabled: false // 禁用版权显示信息
                        }
                    })
                    ;
                }
            });
        }

    }

    // });
</script>
</body>

</html>